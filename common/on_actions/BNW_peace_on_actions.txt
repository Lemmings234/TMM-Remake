on_actions = {
	#### PEACE/WAR VICTORY ON_CAPITULATION BLOCK ####
	#### PUT YOUR SHIT HERE
	# At the end of each global block, set the skip_default_capitulation GLOBAL flag
	# Otherwise shit will just get annexed
	# Really
	# It will.

	# FROM = winner
	# ROOT = country being capitulated/loser
	
	# Anytime y'all are triggering the popup manually, please add 1 to the dirty variable, `global.peace_popup_dirty`
	
	#See TNO_economy_scripted_effects regarding how transfer_GDP works

	on_capitulation = {
		effect = {
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_capitulation"

			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			}
			ROOT = {
				save_global_event_target_as = losing_country
			}

			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"

			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}
			add_to_variable = { global.peace_popup_dirty = 1 }

			FROM = { # winner simply gets GDP recalculated :)
				recalculate_GDP_and_PUs_on_demand = yes
			}

			#Annexation block
			#This if block will only fire if FROM (capitulator) and ROOT (country being capitulated)
			#That is to say, if one side has completely lost (nobody left to fight on)

			if = {
				limit = {
					OR = {
						ROOT = { is_in_faction = no }
						ROOT = {
							all_allied_country = {
								has_capitulated = yes
							}
						}
					}
				}
				log = "war_won"
				set_global_flag = war_won

				#GDP is no longer transferred.
				# every_country = {
				# 	limit = {
				# 		OR = {
				# 			is_in_faction_with = ROOT
				# 			original_tag = ROOT
				# 		}
				# 	}
				# 	FROM = {
				# 		#transfer_GDP = yes
				# 	}
				# }

				# Mountain War, this only triggers if you decide to beat Turkey to death for some reason
				if = {
					limit = {
						FROM = {
							OR = {
							    is_russian_nation = yes 
								original_tag = GEO
								original_tag = ARM
								original_tag = ADY
							}
						}
						ROOT = { original_tag = TUR }
					}
					FROM = {
						every_country = {
							limit = { has_war_with = TUR }
							white_peace = TUR
						}
						if = { #Georgia and Armenia are free
							limit = {
								country_exists = GEO
								country_exists = ARM
							}
							ARM = { 
								transfer_state = 230
								transfer_state = 1567
								dismantle_faction = yes
								add_ideas = CSTO_Member
							}
							GEO = { 
								transfer_state = 231 
								transfer_state = 1556 
								transfer_state = 1558 
								add_ideas = CSTO_Member
								delete_unit_template_and_units = { 
									division_template = "Kveiti Divizia"
									disband = yes
								}
							}
							RUS = {
								set_autonomy = {
									target = GEO
									autonomy_state = autonomy_client_state
								}
								set_autonomy = {
									target = ARM
									autonomy_state = autonomy_client_state
								}
								add_to_faction = GEO
								add_to_faction = ARM
							}
						}
						else_if = { #Caucasian federation
							limit = {
								country_exists = ADY
								NOT = {
									country_exists = GEO
									country_exists = ARM
								}
							}
							ADY = {
								add_state_core = 230
								add_state_core = 1565
								add_state_core = 1567
								add_state_core = 1568
								transfer_state = 230
								transfer_state = 1565
								transfer_state = 1567
							}
						}
						else = { #Russia eats everything
							RUS = {
								transfer_state = 230
								transfer_state = 1565
								transfer_state = 1567
							}
						}
						GRE = {
							transfer_state = 184
							transfer_state = 1266
						}
						# Peace Deal 3 (Has anybody ever seen this?????)
						if = {
							limit = {
								NOT = {
									country_exists = SYR
								}
							}
							SYR = {
								transfer_state = 1242
								transfer_state = 1241
								transfer_state = 1240
								transfer_state = 1371
								transfer_state = 1370
								transfer_state = 677
								transfer_state = 1243
								transfer_state = 1369
								transfer_state = 1372
								transfer_state = 554
								transfer_state = 680
								TNO_startup_nation = yes
							}
							RUS = { puppet = SYR }
						}
						if = {
							limit = {
								NOT = {
									country_exists = KUR
								}
							}
							KUR = {
								transfer_state = 781
								transfer_state = 1334
								TNO_startup_nation = yes
							}
							RUS = { puppet = KUR }
						}
						RUS = { puppet = TUR }
					}
					set_global_flag = skip_default_capitulation
					NOV_Global_Conflict_Helper = yes
				}

				# Liberation of East Turkestan
				else_if = {
					limit = {
						FROM = { is_russian_nation = yes }
						ROOT = { original_tag = XIN }
					}
					FROM = { white_peace = ROOT }
						ETR = {
							add_state_core = 617
							add_state_core = 618
							add_state_core = 957
							add_state_core = 958
							add_state_core = 619
							transfer_state = 617
							transfer_state = 618
							transfer_state = 957
							transfer_state = 958
							transfer_state = 619
						}
						
						FROM = { puppet = ETR }
					set_global_flag = skip_default_capitulation
				}

				# Central Asias - Karakalpak
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    original_tag = IRC
								original_tag = PAV
								original_tag = RUS
							}

						}
						ROOT = { original_tag = KRK }
					}
					FROM = {
						white_peace = KRK
						
						RUS = {
							transfer_state = 750
						}
					}
					set_global_flag = skip_default_capitulation
				}

				# Central Asias - Turkmenistan
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    original_tag = IRC
								original_tag = PAV
								original_tag = RUS
							}

						}
						ROOT = { original_tag = TRK }
					}
					FROM = {
						white_peace = TRK
						
						RUS = {
							annex_country = {
					            target = TRK
					            transfer_troops = no
							}	
						}
					}
					set_global_flag = skip_default_capitulation
				}

				# Central Asias - Uzbekistan
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    original_tag = IRC
								original_tag = PAV
								original_tag = RUS
							}

						}
						ROOT = { original_tag = UZB }
					}
					FROM = {
						white_peace = UZB
						
						RUS = {
							annex_country = {
					            target = UZB
					            transfer_troops = no
							}	
						}
					}
					set_global_flag = skip_default_capitulation
				}

				# Central Asias - Krygystan
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    original_tag = IRC
								original_tag = PAV
								original_tag = RUS
							}

						}
						ROOT = { original_tag = KYR }
					}
					FROM = {
						white_peace = KYR
						RUS = {
							annex_country = {
					            target = KYR
					            transfer_troops = no
							}	
						}
					}
					set_global_flag = skip_default_capitulation
				}

				# Central Asias - Tajikstan
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    original_tag = IRC
								original_tag = PAV
								original_tag = RUS
							}

						}
						ROOT = { original_tag = TAJ }
					}
					FROM = {
						white_peace = TAJ
						RUS = {
							annex_country = {
					            target = TAJ
					            transfer_troops = no
							}	
						}
					}
					set_global_flag = skip_default_capitulation
				}

				# Central Asias - Turks
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    original_tag = IRC
								original_tag = PAV
								original_tag = RUS
							}

						}
						ROOT = { original_tag = UTL }
					}
					FROM = {
						white_peace = UTL
						
						RUS = {
							annex_country = {
					            target = UTL
					            transfer_troops = no
							}	
						}
					}
					set_global_flag = skip_default_capitulation
				}

				# Qinghai Beats Tibet
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    original_tag = QIN
								original_tag = XIK
							}

						}
						ROOT = { original_tag = TIB }
					}
					FROM = {
						white_peace = ROOT
						
						QIN = {
							transfer_state = 322
							transfer_state = 601
							transfer_state = 434
							transfer_state = 1962
							transfer_state = 1961
							
						}
						BHU = {
							transfer_state = 2209
						}
						AZH = {
							transfer_state = 1963
						}
						1962 = { set_demilitarized_zone = yes }
						1961 = { set_demilitarized_zone = yes }
						1963 = { set_demilitarized_zone = yes }
						434 = { set_demilitarized_zone = yes }
					}
					set_global_flag = skip_default_capitulation
				}

				# Qinghai Beats Seihoku
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    original_tag = QIN
								original_tag = XIK
							}
						}
						ROOT = { original_tag = GAN }
					}
					FROM = {
						white_peace = ROOT

			            every_country = {
			            	limit = {
			            		OR = {
			            		    tag = JAP
			            		    is_in_faction_with = JAP
			            		}
			            		has_war_with = JAP
			            	}
                            white_peace = QIN
							white_peace = XIK
			            }
						
						QIN = {
							transfer_state = 283
							transfer_state = 616
							transfer_state = 764
							transfer_state = 1302

							set_capital = { state = 906 }
	
		                    add_victory_points = {
                            	province = 10490
                            	value = 15
                            }
						    BNW_TMM_Temp_End_Helper = yes
						}
						QIN = { country_event = { id = GAW.1 days = 19 } }

					}
					set_global_flag = skip_default_capitulation
				}

				# CCW - Nanjing takes out rebels (Removed from game)
				else_if = {
					limit = {
						FROM = { 
							OR = {
							    tag = CHI
								is_in_faction_with = CHI
							}
						}
						ROOT = { original_tag = SHX }
					}
					FROM = {
						white_peace = ROOT
						
						CHI = {
							transfer_state = 622
						}
					}
					set_global_flag = skip_default_capitulation
				}

				# Romania
				else_if = {
					limit = {
						FROM = { is_russian_nation = yes }
						ROOT = { original_tag = ROM }
					}
					FROM = {
						white_peace = ROOT
			            every_country = {
			            	limit = {
			            		OR = {
			            		    tag = ITA
			            		    is_subject_of = ITA
									is_in_faction_with = USA
									is_in_faction_with = JAP
			            		}
			            		has_war_with = RUS
			            	}
                            white_peace = RUS
			            }
						ROM = {
							transfer_state = 1281
							transfer_state = 46
							transfer_state = 81
							transfer_state = 84
							transfer_state = 1283
							transfer_state = 79
							transfer_state = 1284
							transfer_state = 80
							transfer_state = 78
							transfer_state = 1286
							transfer_state = 1289
							transfer_state = 1288
							transfer_state = 76
							transfer_state = 83
							transfer_state = 82
							transfer_state = 1285
							transfer_state = 1287

							set_cosmetic_tag = ROM_REPUBLIC
							add_ideas = CSTO_Member
							
							set_temp_variable = { TNO_economy_type_temp = token:Econ_Type_Capitalism }
							econ_type_change = yes
							econ_join_sphere_RUS = yes
							XXX = { ROM_Ion_Iliescu = { set_nationality = ROM } }
							ROM_Ion_Iliescu = { promote_character = progressivism }

							set_politics = {
								ruling_party = progressivism
							}

							add_popularity = {
								ideology = progressivism
								popularity = 0.3
							}

							set_party_name = {
								ideology = progressivism
								long_name = ROM_social_democracy_party_long
								name = ROM_social_democracy_party
							}
							remove_ideas = {
					            ROM_legacy_of_the_kings_coup
					            ROM_reign_of_the_steel_crown
								ita_lira_zone
							}
							get_current_government_type = yes
			                save_party_popularities = yes
						}

		                RUS = {
			                set_autonomy = {
				                target = ROM
				                autonomy_state = autonomy_client_state
							}	
						}
						
		                ROM = {
			                restore_previous_government_type = yes
			                apply_party_popularities = yes
		                }

						if = {
							limit = {
								country_exists = FUK
								FUK = {
									is_puppet_of = RUS
								}
							}
							FUK = {
								
								add_state_core = 192
								add_state_core = 198
								add_state_core = 1282
								add_state_core = 1285
								add_state_core = 1965
								add_state_core = 1966
								transfer_state = 192
								transfer_state = 198
								transfer_state = 1282
								transfer_state = 1285
								transfer_state = 1965
								transfer_state = 1966
							}
						}
						
						else = {
							RUS = {
								
								add_state_core = 192
								add_state_core = 198
								add_state_core = 1282
								add_state_core = 1285
								add_state_core = 1965
								add_state_core = 1966
								transfer_state = 192
								transfer_state = 198
								transfer_state = 1282
								transfer_state = 1285
								transfer_state = 1965
								transfer_state = 1966
							}
						}
						
						every_country = {
							news_event = { id = WORLD.40032 days = 1 }
						}
					}
					
					set_global_flag = skip_default_capitulation
				}

				# West China War
				else_if = {
					limit = {
						FROM = { original_tag = QIN }
						ROOT = { original_tag = XIN }
					}
					FROM = {
						white_peace = ROOT
						
						QIN = {
							add_state_core = 617
							add_state_core = 618
							add_state_core = 957
							add_state_core = 958
							add_state_core = 619
							add_state_core = 964
							add_state_core = 905
							transfer_state = 617
							transfer_state = 618
							transfer_state = 957
							transfer_state = 958
							transfer_state = 619
							transfer_state = 964
							transfer_state = 905
							econ_join_sphere_RUS = yes
							add_ideas = CSTO_Member
						}
						RUS = { add_to_faction = QIN }
					}
					NOV_Global_Conflict_Helper = yes
					set_global_flag = skip_default_capitulation
				}

				#Mongolia
				else_if = {
					limit = {
						FROM = { original_tag = MON }
						ROOT = { original_tag = MEN }
					}
					FROM = {
						white_peace = ROOT
						
						MON = {
							transfer_state = 815
							add_state_core = 815
							add_ideas = CSTO_Member
							econ_join_sphere_RUS = yes
						}
						RUS = { add_to_faction = MON }
						white_peace = JAP
					}
					NOV_Global_Conflict_Helper = yes
					set_global_flag = skip_default_capitulation
				}

				# If you lose mongolia war like a retard
				else_if = {
					limit = {
						FROM = { original_tag = MEN }
						ROOT = { original_tag = MON }
					}
					FROM = {
						white_peace = ROOT
						MEN = {
							transfer_state = 814
							transfer_state = 330
						}
						MON = {
							remove_state_core = 814
							remove_state_core = 330
						}
					}
					NOV_Global_Conflict_Helper = yes
					set_global_flag = skip_default_capitulation
				}

				#Krakow Uprising
				else_if = {
					limit = {
						FROM = { original_tag = POL }
						ROOT = { original_tag = GGN }
						has_global_flag = RUS_krakow_uprising
					}
					FROM = {
						white_peace = ROOT
						white_peace = GER
						
						transfer_state = 1384
						transfer_state = 1380
						transfer_state = 10
						transfer_state = 1381
						transfer_state = 1383
						transfer_state = 90
						transfer_state = 1382
						transfer_state = 92
						set_capital = { state = 10 remember_old_capital = no}
						remove_ideas = Pakt_Marionettenstaat
						set_country_flag = POL_p2
						every_country = {
							news_event = { id = Global_Conflicts.6 days = 1 }
						}
					}
					NOV_Global_Conflict_Helper = yes
					set_global_flag = skip_default_capitulation
				}

				#If you loose Krakow Uprising LMAO
				else_if = {
					limit = {
						FROM = { original_tag = GGN }
						ROOT = { original_tag = POL }
						has_global_flag = RUS_krakow_uprising
					}
					FROM = {
						white_peace = ROOT
						
						transfer_state = 88
						transfer_state = 1385
						transfer_state = 1386
						transfer_state = 1389
						transfer_state = 1390
						transfer_state = 1391
						transfer_state = 1387
						transfer_state = 1392
						transfer_state = 1393
						transfer_state = 1394
						transfer_state = 91
						transfer_state = 94
						transfer_state = 89
						transfer_state = 1388

						1391 = {
							set_victory_points = {
								province = 11479
								value = 5
							}
							add_manpower = -150000
							set_temp_variable = { state_value_multiplier_temp = 0.66 }
							econ_state_value_change_multiply = yes
						}
						88 = {
							set_victory_points = {
								province = 15816
								value = 5
							}
							add_manpower = -150000
							set_temp_variable = { state_value_multiplier_temp = 0.66 }
							econ_state_value_change_multiply = yes
						}
						1385 = {
							set_victory_points = {
								province = 442
								value = 0
							}
							set_victory_points = {
								province = 6499
								value = 0
							}
							add_manpower = -150000
							set_temp_variable = { state_value_multiplier_temp = 0.66 }
							econ_state_value_change_multiply = yes
						}
						1389 = {
							set_victory_points = {
								province = 11399
								value = 0
							}
							add_manpower = -150000
							set_temp_variable = { state_value_multiplier_temp = 0.66 }
							econ_state_value_change_multiply = yes
						}
						1386 = {
							set_victory_points = {
								province = 3434
								value = 0
							}
							add_manpower = -150000
							set_temp_variable = { state_value_multiplier_temp = 0.66 }
							econ_state_value_change_multiply = yes
						}
						get_current_government_type = yes
						save_party_popularities = yes
						if ={
							limit = {
								GER = { has_country_flag = BOR_Herbst }
							}
							GER = {
								set_autonomy = {
									target = GGN
									autonomy_state = autonomy_integrated_reichskommissariat
								}
							}
						}
						else = {
							GER = {
								set_autonomy = {
									target = GGN
									autonomy_state = autonomy_collaborator_puppet_state
								}
							}
						}
						restore_previous_government_type = yes
			        	apply_party_popularities = yes
					}
					NOV_Global_Conflict_Helper = yes
					every_country = { news_event = { id = Global_Conflicts.7 days = 1 } }
					set_global_flag = skip_default_capitulation
				}
				#Kazakhstan
				else_if = {
					limit = {
						FROM = { is_russian_nation = yes }
						ROOT = { is_kazakh_nation = yes }
					}
					FROM = {
						white_peace = ROOT
						if = {
							limit = {
								NOT ={
									any_other_country = {
										is_kazakh_nation = yes
										exists = yes
									}
								}
							}
							set_country_flag = NOV_shukshin_conquered_kaz_flag
						}
					}
					set_global_flag = skip_default_capitulation
				}

				#Capitulation block
				set_global_flag = war_continuing
			}
			clr_global_flag = skip_default_capitulation
		}
	}
	#don't mind me just logging wars
	on_declare_war = {
		effect = {
			log="[GetDateText]: [Root.GetName] declared war on [From.GetName]"
		}
	}
}